<!DOCTYPE html>
<html>
<head>
  <title>Swords of Shadows</title>
  <style>
    body { background: #000; }
    #gameCanvas { background: #fff; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
  var canvas = document.getElementById('gameCanvas');
  var context = canvas.getContext('2d');

  var player = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    width: 50,
    height: 50,
    color: 'red',
    speed: 5,
    moveLeft: false,
    moveRight: false,
    moveUp: false,
    moveDown: false,
  };

  var enemy = {
    x: Math.random() * (canvas.width - 100) + 50, // Random position, considering the walls
    y: Math.random() * (canvas.height - 100) + 50, // Random position, considering the walls
    width: 50,
    height: 50,
    color: 'blue',
    speed: 2
  };

  var caveOpening = {
    width: 100,
    height: 50,
    x: canvas.width / 2 - 50, // Initially positioned in the center
    y: canvas.height - 50,    // Positioned at the bottom
  };

  var isGameOver = false;

  function drawPlayer() {
    context.fillStyle = player.color;
    context.fillRect(player.x, player.y, player.width, player.height);
  }

  function drawEnemy() {
    context.fillStyle = enemy.color;
    context.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  }

  function drawWalls() {
    context.fillStyle = 'gray';
    // Draw top wall
    context.fillRect(0, 0, canvas.width, 50);
    // Draw bottom walls
    context.fillRect(0, canvas.height - 50, caveOpening.x, 50);
    context.fillRect(caveOpening.x + caveOpening.width, canvas.height - 50, canvas.width - caveOpening.x - caveOpening.width, 50);
    // Draw left and right walls
    context.fillRect(0, 0, 50, canvas.height);
    context.fillRect(canvas.width - 50, 0, 50, canvas.height);
  }

  function updatePlayerPosition() {
    if (player.moveLeft) player.x -= player.speed;
    if (player.moveRight) player.x += player.speed;
    if (player.moveUp) player.y -= player.speed;
    if (player.moveDown) player.y += player.speed;

    // Check for canvas boundaries
    if (player.x < 50) player.x = 50;
    if (player.y < 50) player.y = 50;
    if (player.x + player.width > canvas.width - 50) player.x = canvas.width - 50 - player.width;
    if (player.y + player.height > caveOpening.y) {
      // If player is not within the cave opening at the bottom, block them
      if (player.x < caveOpening.x || player.x + player.width > caveOpening.x + caveOpening.width) {
        player.y = caveOpening.y - player.height;
      } else {
        // If player goes through the cave opening, move them back and reposition the opening
        player.y = canvas.height / 2;
        caveOpening.x = Math.random() * (canvas.width - 150) + 50;
      }
    }

    // Check for collision with enemy
    if (checkCollision(player, enemy)) {
      isGameOver = true;
      alert('Game Over');
      location.reload(); // Refresh the page
    }
  }

  function updateEnemyPosition() {
    var dx = player.x - enemy.x;
    var dy = player.y - enemy.y;
    var dist = Math.sqrt(dx*dx + dy*dy);

    if (dist) {
      dx /= dist;  // Normalize
      dy /= dist;  // Normalize

      enemy.x += dx * enemy.speed;
      enemy.y += dy * enemy.speed;
    }
  }

  window.addEventListener('keydown', function(e) {
    switch(e.key) {
      case 'ArrowUp': player.moveUp = true; break;
      case 'ArrowDown': player.moveDown = true; break;
      case 'ArrowLeft': player.moveLeft = true; break;
      case 'ArrowRight': player.moveRight = true; break;
    }
  });

  window.addEventListener('keyup', function(e) {
    console.log('key');
    switch(e.key) {
      case 'ArrowUp': player.moveUp = false; break;
      case 'ArrowDown': player.moveDown = false; break;
      case 'ArrowLeft': player.moveLeft = false; break;
      case 'ArrowRight': player.moveRight = false; break;
    }
  });

  function checkCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect2.x < rect1.x + rect1.width &&
           rect1.y < rect2.y + rect2.height &&
           rect2.y < rect1.y + rect1.height;
  }

  function gameLoop() {

    if(isGameOver) return; // Exit game loop if game over

    context.clearRect(0, 0, canvas.width, canvas.height);
    drawWalls();
    updatePlayerPosition();
    updateEnemyPosition();
    drawEnemy();
    drawPlayer();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
</body>
</html>
