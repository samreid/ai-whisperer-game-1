<!DOCTYPE html>
<html>
<head>
  <title>Swords of Shadows</title>
  <style>
    body { background: #000; }
    #gameCanvas { background: #fff; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="800" height="600"></canvas>

<script>
  var canvas = document.getElementById('gameCanvas');
  var context = canvas.getContext('2d');

  var player = {
    x: canvas.width / 2,
    y: canvas.height / 2,
    width: 20,
    height: 20,
    color: 'red',
    speed: 3,
    direction: 'right',
    dx: 0,
    dy: 0
  };

  var weapon = {
    width: 50,
    height: 10,
    color: 'black'
  };

  var enemy = {
    x: 100,
    y: 100,
    width: 20,
    height: 20,
    color: 'blue',
    speed: 2
  };

  var keys = {};

  var score = 0;

  var isGameOver = false;
  var isAttacking = false;

  function drawPlayer() {
    context.fillStyle = player.color;
    context.fillRect(player.x, player.y, player.width, player.height);
  }

  function drawWeapon() {
    if (isAttacking) {
      context.fillStyle = weapon.color;
      switch(player.direction) {
        case 'left':
          context.fillRect(player.x - weapon.width, player.y, weapon.width, weapon.height);
          break;
        case 'right':
          context.fillRect(player.x + player.width, player.y, weapon.width, weapon.height);
          break;
        case 'up':
          context.fillRect(player.x, player.y - weapon.width, weapon.height, weapon.width);
          break;
        case 'down':
          context.fillRect(player.x, player.y + player.width, weapon.height, weapon.width);
          break;
      }
    }
  }

  function drawEnemy() {
    context.fillStyle = enemy.color;
    context.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
  }

  function drawWalls() {
    context.fillStyle = '#808080';
    context.fillRect(0, 0, canvas.width, 20);
    context.fillRect(0, canvas.height - 20, canvas.width, 20);
    context.fillRect(0, 0, 20, canvas.height);
    context.fillRect(canvas.width - 20, 0, 20, canvas.height - 60);
  }

  function drawScore() {
    context.font = "20px Arial";
    context.fillStyle = 'black';
    context.fillText("Score: " + score, 10, 30);
  }

  function checkCollision(rect1, rect2) {
    return rect1.x < rect2.x + rect2.width &&
           rect1.x + rect1.width > rect2.x &&
           rect1.y < rect2.y + rect2.height &&
           rect1.y + rect1.height > rect2.y;
  }

  function getWeaponDimensions() {
    var weaponX, weaponY, weaponWidth, weaponHeight;
    switch(player.direction) {
      case 'left':
        weaponX = player.x - weapon.width;
        weaponY = player.y;
        weaponWidth = weapon.width;
        weaponHeight = weapon.height;
        break;
      case 'right':
        weaponX = player.x + player.width;
        weaponY = player.y;
        weaponWidth = weapon.width;
        weaponHeight = weapon.height;
        break;
      case 'up':
        weaponX = player.x;
        weaponY = player.y - weapon.width;
        weaponWidth = weapon.height;
        weaponHeight = weapon.width;
        break;
      case 'down':
        weaponX = player.x;
        weaponY = player.y + player.width;
        weaponWidth = weapon.height;
        weaponHeight = weapon.width;
        break;
    }
    return {
      x: weaponX,
      y: weaponY,
      width: weaponWidth,
      height: weaponHeight
    };
  }

  window.addEventListener('keydown', function(e) {
    keys[e.keyCode] = true;

    switch(e.keyCode) {
      case 32: // Spacebar
        isAttacking = true;
        if (checkCollision(getWeaponDimensions(), enemy)) {
          score++;
          enemy.x = Math.random() * (canvas.width - 100) + 50;
          enemy.y = Math.random() * (canvas.height - 100) + 50;
        }
        break;
    }
  });

  window.addEventListener('keyup', function(e) {
    delete keys[e.keyCode];
    if (e.keyCode === 32) { // Space bar
      isAttacking = false;
    }
  });

  function updatePlayerPosition() {
    if (keys[37]) {
      player.dx = -player.speed;
      player.direction = 'left';
    } else if (keys[39]) {
      player.dx = player.speed;
      player.direction = 'right';
    } else {
      player.dx = 0;
    }

    if (keys[38]) {
      player.dy = -player.speed;
      player.direction = 'up';
    } else if (keys[40]) {
      player.dy = player.speed;
      player.direction = 'down';
    } else {
      player.dy = 0;
    }

    player.x += player.dx;
    player.y += player.dy;

    if (checkCollision(player, enemy) && !isAttacking) {
      isGameOver = true;
      alert('Game Over');
      location.reload();
    }
  }

  function updateEnemyPosition() {
    var dx = player.x - enemy.x;
    var dy = player.y - enemy.y;
    var dist = Math.sqrt(dx*dx + dy*dy);

    if (dist) {
      dx /= dist;  // Normalize
      dy /= dist;  // Normalize

      enemy.x += dx * enemy.speed;
      enemy.y += dy * enemy.speed;
    }
  }

  function gameLoop() {
    if(isGameOver) return;
    context.clearRect(0, 0, canvas.width, canvas.height);
    drawWalls();
    drawScore();
    updatePlayerPosition();
    updateEnemyPosition();
    drawPlayer();
    drawWeapon();
    drawEnemy();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>
</body>
</html>
